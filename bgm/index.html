
<meta charset="UTF-8">
<button onclick="start()">start</button>


<script>
    let bufferData;
    let audioBuffer;
    let lastAt;
    var ctx;
    const wav = "./楽しいカジノ.wav";
    function start() {
        if (!bufferData) {
            alert("bufferData null");
            return
        }
        ctx = new AudioContext();


        ctx.decodeAudioData(bufferData, (audioBufferIn) => {
            audioBuffer = audioBufferIn;

            {
                const audioSource = ctx.createBufferSource();
                audioSource.buffer = audioBuffer;
                audioSource.connect(ctx.destination);
                lastAt = ctx.currentTime + 1;
                audioSource.start(lastAt);
            }
            {
                const audioSource = ctx.createBufferSource();
                audioSource.buffer = audioBuffer;
                audioSource.connect(ctx.destination);
                lastAt += 60 + 31.406;
                audioSource.start(lastAt);
            }
        });
    }

    const playDiff =  60 + 31.406;

    function tryPlaySound() {
        if (lastAt + playDiff > ctx.currentTime + 10) {
            const audioSource = ctx.createBufferSource();
            audioSource.buffer = audioBuffer;
            audioSource.connect(ctx.destination);
            lastAt += playDiff;
            audioSource.start(lastAt);
        }
    }

    setInterval(tryPlaySound, 1000);

    const request = new XMLHttpRequest();
    const url = wav;
    request.open('GET', url, true);
    request.responseType = 'arraybuffer';
    request.onload =  () => {bufferData = request.response};
    request.send();
</script>

